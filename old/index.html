<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mario Camacho">

<title>Choice of Brand for Crackers</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Índice</h2>
   
  <ul>
  <li><a href="#database" id="toc-database" class="nav-link active" data-scroll-target="#database">Database</a>
  <ul class="collapse">
  <li><a href="#descripción" id="toc-descripción" class="nav-link" data-scroll-target="#descripción">Descripción</a></li>
  <li><a href="#datos-por-individuo" id="toc-datos-por-individuo" class="nav-link" data-scroll-target="#datos-por-individuo">Datos por individuo</a></li>
  <li><a href="#distribución-de-las-preferencias" id="toc-distribución-de-las-preferencias" class="nav-link" data-scroll-target="#distribución-de-las-preferencias">Distribución de las preferencias</a></li>
  <li><a href="#escala" id="toc-escala" class="nav-link" data-scroll-target="#escala">Escala</a></li>
  </ul></li>
  <li><a href="#análisis-exploratorio" id="toc-análisis-exploratorio" class="nav-link" data-scroll-target="#análisis-exploratorio">Análisis exploratorio</a>
  <ul class="collapse">
  <li><a href="#eliminación-datos-confusos" id="toc-eliminación-datos-confusos" class="nav-link" data-scroll-target="#eliminación-datos-confusos">Eliminación datos confusos</a></li>
  <li><a href="#distribución-del-precio" id="toc-distribución-del-precio" class="nav-link" data-scroll-target="#distribución-del-precio">Distribución del precio</a></li>
  </ul></li>
  <li><a href="#modelo-predictivo" id="toc-modelo-predictivo" class="nav-link" data-scroll-target="#modelo-predictivo">Modelo predictivo</a>
  <ul class="collapse">
  <li><a href="#objetivo" id="toc-objetivo" class="nav-link" data-scroll-target="#objetivo">Objetivo</a></li>
  <li><a href="#enfoque-del-modelo" id="toc-enfoque-del-modelo" class="nav-link" data-scroll-target="#enfoque-del-modelo">Enfoque del modelo</a></li>
  <li><a href="#train-y-test" id="toc-train-y-test" class="nav-link" data-scroll-target="#train-y-test">Train y test</a></li>
  <li><a href="#modelo-respuesta-múltiple-nominal" id="toc-modelo-respuesta-múltiple-nominal" class="nav-link" data-scroll-target="#modelo-respuesta-múltiple-nominal">Modelo respuesta múltiple nominal</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content column-page-right" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Choice of Brand for Crackers</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mario Camacho </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Ecdat)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpivotTable)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VGAM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="database" class="level1">
<h1>Database</h1>
<section id="descripción" class="level2">
<h2 class="anchored" data-anchor-id="descripción">Descripción</h2>
<p>En este caso de uso utilizamos la base de datos Cracker del paquete Ecdat sobre la elección de un individuo de una marca de galletas saladas entre cuatro opciones posibles. (Sunshine, Kleebler, Nabisco y Private)</p>
<p>La base de datos contiene 3.292 registros y dentro de cada fila tenemos:</p>
<ul>
<li><strong>id</strong>: individuals identifiers<br>
</li>
<li><strong>choice</strong>: one of sunshine, kleebler, nabisco, private<br>
</li>
<li><strong>disp.z</strong>: is there a display for brand z ?<br>
</li>
<li><strong>feat.z</strong>: is there a newspaper feature advertisement for brand z ?<br>
</li>
<li><strong>price.z</strong>: price of brand z</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cracker)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       id         disp.sunshine    disp.kleebler     disp.nabisco     disp.private     feat.sunshine    
 Min.   :  1.00   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.00000   Min.   :0.00000  
 1st Qu.: 35.00   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000  
 Median : 67.00   Median :0.0000   Median :0.0000   Median :0.0000   Median :0.00000   Median :0.00000  
 Mean   : 67.49   Mean   :0.1288   Mean   :0.1063   Mean   :0.3402   Mean   :0.09872   Mean   :0.03767  
 3rd Qu.: 99.00   3rd Qu.:0.0000   3rd Qu.:0.0000   3rd Qu.:1.0000   3rd Qu.:0.00000   3rd Qu.:0.00000  
 Max.   :136.00   Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :1.00000   Max.   :1.00000  
 feat.kleebler      feat.nabisco      feat.private     price.sunshine  price.kleebler  price.nabisco  
 Min.   :0.00000   Min.   :0.00000   Min.   :0.00000   Min.   : 49.0   Min.   : 88.0   Min.   :  0.0  
 1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.: 89.0   1st Qu.:105.0   1st Qu.: 99.0  
 Median :0.00000   Median :0.00000   Median :0.00000   Median : 97.0   Median :109.0   Median :109.0  
 Mean   :0.04253   Mean   :0.08657   Mean   :0.04708   Mean   : 95.7   Mean   :112.6   Mean   :107.9  
 3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:105.0   3rd Qu.:121.0   3rd Qu.:119.0  
 Max.   :1.00000   Max.   :1.00000   Max.   :1.00000   Max.   :129.0   Max.   :139.0   Max.   :169.0  
 price.private         choice    
 Min.   : 38.00   sunshine: 239  
 1st Qu.: 59.00   kleebler: 226  
 Median : 65.00   nabisco :1792  
 Mean   : 68.07   private :1035  
 3rd Qu.: 78.00                  
 Max.   :115.00                  </code></pre>
</div>
</div>
</section>
<section id="datos-por-individuo" class="level2">
<h2 class="anchored" data-anchor-id="datos-por-individuo">Datos por individuo</h2>
<p>Se han recogido datos de 136 individuos. Cada individuo tiene de media 21 registros.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Cracker <span class="sc">|&gt;</span> <span class="fu">select</span>(id) <span class="sc">|&gt;</span> <span class="fu">table</span>() <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">select</span>(Freq) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Freq      
 Min.   :14.00  
 1st Qu.:16.75  
 Median :21.00  
 Mean   :24.21  
 3rd Qu.:29.00  
 Max.   :77.00  </code></pre>
</div>
</div>
<p>Tomamos de ejemplo algunos de los registros del id 1.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>Cracker <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  id disp.sunshine disp.kleebler disp.nabisco disp.private feat.sunshine feat.kleebler feat.nabisco
1  1             0             0            0            0             0             0            0
2  1             0             0            0            0             0             0            0
3  1             1             0            0            0             0             0            0
4  1             0             0            0            0             0             0            0
5  1             0             0            0            0             0             0            0
  feat.private price.sunshine price.kleebler price.nabisco price.private   choice
1            0             98             88           120            71  nabisco
2            0             99            109            99            71  nabisco
3            0             49            109           109            78 sunshine
4            0            103            109            89            78  nabisco
5            0            109            109           119            64  nabisco</code></pre>
</div>
</div>
</section>
<section id="distribución-de-las-preferencias" class="level2">
<h2 class="anchored" data-anchor-id="distribución-de-las-preferencias">Distribución de las preferencias</h2>
<p>Para cada usuario contamos el número de veces que ha elegido cada una de las marcas.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>data_0 <span class="ot">&lt;-</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>Cracker <span class="sc">|&gt;</span> <span class="fu">select</span>(id, choice) <span class="sc">|&gt;</span> <span class="fu">group_by_all</span>() <span class="sc">|&gt;</span> <span class="fu">count</span>(,<span class="at">.drop =</span> <span class="cn">FALSE</span>)  <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">p =</span> n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">.by=</span>id) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#mutate(scale = scale(p, scale = FALSE), .by=id) |&gt; </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id,<span class="sc">-</span>n) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">preference =</span> <span class="fu">row_number</span>(), <span class="at">.by=</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>El individuo 1 ha elegido la marca Nabisco en el 87.5 % de las veces.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
     id choice       n     p preference
  &lt;dbl&gt; &lt;fct&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;int&gt;
1     1 nabisco     14 0.875          1
2     1 sunshine     2 0.125          2
3     1 kleebler     0 0              3
4     1 private      0 0              4
5     2 sunshine    10 0.625          1
6     2 nabisco      4 0.25           2
7     2 kleebler     2 0.125          3
8     2 private      0 0              4</code></pre>
</div>
</div>
<p>La distribución de la preferencia de cada marca:</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_0 <span class="sc">|&gt;</span> <span class="fu">select</span>(choice, preference) <span class="sc">|&gt;</span> <span class="fu">table</span>() <span class="sc">|&gt;</span> <span class="fu">addmargins</span>()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  data_0 <span class="sc">|&gt;</span> <span class="fu">select</span>(choice, preference) <span class="sc">|&gt;</span> <span class="fu">table</span>() <span class="sc">|&gt;</span> <span class="fu">prop.table</span>(<span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">addmargins</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<pre><code>          preference
choice       1   2   3   4 Sum
  sunshine   8  60  59   9 136
  kleebler   6  18  63  49 136
  nabisco   82  30   9  15 136
  private   40  28   5  63 136
  Sum      136 136 136 136 544</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<pre><code>          preference
choice          1      2      3      4    Sum
  sunshine   5.88  44.12  43.38   6.62 100.00
  kleebler   4.41  13.24  46.32  36.03 100.00
  nabisco   60.29  22.06   6.62  11.03 100.00
  private   29.41  20.59   3.68  46.32 100.00
  Sum       99.99 100.01 100.00 100.00 400.00</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="escala" class="level2">
<h2 class="anchored" data-anchor-id="escala">Escala</h2>
<p>Creamos una escala teniendo en cuenta las preferencias del individuo e incluyendo el porcentaje de veces que elige cada una de las marcas sobre el total de sus elecciones.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>data_1 <span class="ot">&lt;-</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>data_0 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">scale =</span> <span class="fu">scale</span>(p, <span class="at">scale =</span> <span class="cn">FALSE</span>), <span class="at">.by=</span>id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Esta escala tiene una relación directa con la proporción de cada una de las elecciones. Se mueve entre los valores -0.25 y 0.75.</p>
<ul>
<li>El valor -0.25 si esa marca nunca ha sido elegida por el individuo (p=0).</li>
<li>El valor 0.75 si es la única marca elegida por el usuario (p=1).</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>data_1 <span class="sc">|&gt;</span> <span class="fu">select</span>(choice, p, scale) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      choice          p                 scale.V1      
 sunshine:136   Min.   :0.00000   Min.   :-0.2500000  
 kleebler:136   1st Qu.:0.00000   1st Qu.:-0.2500000  
 nabisco :136   Median :0.05556   Median :-0.1944444  
 private :136   Mean   :0.25000   Mean   : 0.0000000  
                3rd Qu.:0.43902   3rd Qu.: 0.1890244  
                Max.   :1.00000   Max.   : 0.7500000  </code></pre>
</div>
</div>
<p>Si las elecciones fueran fruto del azar, cada marca sería elegida un 25 % por cada individuo. Con la escala creado cuantificamos cuánto se desvía la proporción de cada elección sobre este porcentaje esperado.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data_1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
     id choice       n     p preference scale[,1]
  &lt;dbl&gt; &lt;fct&gt;    &lt;int&gt; &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;
1     1 nabisco     14 0.875          1     0.625
2     1 sunshine     2 0.125          2    -0.125
3     1 kleebler     0 0              3    -0.25 
4     1 private      0 0              4    -0.25 </code></pre>
</div>
</div>
<p>Los individuos 7 y 123 han hecho un total de 17 elecciones siendo su marca preferida Nabisco.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data_1 <span class="sc">|&gt;</span> <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">123</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 6
     id choice       n      p preference scale[,1]
  &lt;dbl&gt; &lt;fct&gt;    &lt;int&gt;  &lt;dbl&gt;      &lt;int&gt;     &lt;dbl&gt;
1     7 nabisco     12 0.706           1    0.456 
2     7 kleebler     4 0.235           2   -0.0147
3     7 sunshine     1 0.0588          3   -0.191 
4     7 private      0 0               4   -0.25  
5   123 nabisco     14 0.824           1    0.574 
6   123 sunshine     1 0.0588          2   -0.191 
7   123 kleebler     1 0.0588          3   -0.191 
8   123 private      1 0.0588          4   -0.191 </code></pre>
</div>
</div>
</section>
</section>
<section id="análisis-exploratorio" class="level1">
<h1>Análisis exploratorio</h1>
<section id="eliminación-datos-confusos" class="level2">
<h2 class="anchored" data-anchor-id="eliminación-datos-confusos">Eliminación datos confusos</h2>
<p>Existen tres registros donde el precio de la marca Nabisco es cero. Puede deberse a alguna oferta que no tengamos recogida o error en los datos. Eliminamos estos registros</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>Cracker <span class="sc">|&gt;</span> <span class="fu">filter</span>(price.nabisco<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="fu">contains</span>(<span class="st">'nabisco'</span>),<span class="st">'choice'</span>))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>Cracker_clean <span class="ot">&lt;-</span> Cracker <span class="sc">|&gt;</span> <span class="fu">filter</span>(price.nabisco<span class="sc">&gt;</span><span class="dv">0</span>) </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     disp.nabisco feat.nabisco price.nabisco  choice
319             1            0             0 nabisco
321             0            0             0 nabisco
1051            0            0             0 nabisco</code></pre>
</div>
</div>
</section>
<section id="distribución-del-precio" class="level2">
<h2 class="anchored" data-anchor-id="distribución-del-precio">Distribución del precio</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Cracker_clean <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">'price'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> price.sunshine  price.kleebler  price.nabisco price.private   
 Min.   : 49.0   Min.   : 88.0   Min.   : 49   Min.   : 38.00  
 1st Qu.: 89.0   1st Qu.:105.0   1st Qu.: 99   1st Qu.: 59.00  
 Median : 97.0   Median :109.0   Median :109   Median : 65.00  
 Mean   : 95.7   Mean   :112.6   Mean   :108   Mean   : 68.08  
 3rd Qu.:105.0   3rd Qu.:121.0   3rd Qu.:119   3rd Qu.: 78.00  
 Max.   :129.0   Max.   :139.0   Max.   :169   Max.   :115.00  </code></pre>
</div>
</div>
<p>Definimos el precio de la marca elegida por el usuario y lo enfrentamos al precio medio de las elecciones que tenía el individuo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>data_2 <span class="ot">&lt;-</span> Cracker_clean <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">precio_medio =</span> (price.sunshine <span class="sc">+</span> price.kleebler <span class="sc">+</span> price.nabisco <span class="sc">+</span> price.private) <span class="sc">/</span> <span class="dv">4</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">precio_preferencia =</span> <span class="fu">case_when</span>(choice <span class="sc">==</span> <span class="st">"sunshine"</span> <span class="sc">~</span> price.sunshine,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                                                                        choice <span class="sc">==</span> <span class="st">"kleebler"</span> <span class="sc">~</span> price.kleebler,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                                                        choice <span class="sc">==</span> <span class="st">"nabisco"</span> <span class="sc">~</span> price.nabisco,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                                                        choice <span class="sc">==</span> <span class="st">"private"</span> <span class="sc">~</span> price.private),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">id=</span><span class="fu">factor</span>(id))</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="co"># |&gt;</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(precio_preferencia, precio_medio, id, choice)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ajustar gráfico a ancho de la página cambiar título leyenda</p>
</div>
</div>
<p>La marca Private casi siempre tiene un precio superior al precio medio de las cuatro marcas cuando es la marca que el individuo prefiere. Aquellos casos donde la marca elegida es la marca Nabisco, el precio de esta elección casi siempre es inferior al precio medio de las cuatro marcas.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data_2 <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>precio_preferencia, <span class="at">y=</span>precio_medio, <span class="at">colour =</span> <span class="fu">factor</span>(choice))) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">30</span>, <span class="dv">150</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">30</span>, <span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="modelo-predictivo" class="level1">
<h1>Modelo predictivo</h1>
<section id="objetivo" class="level2">
<h2 class="anchored" data-anchor-id="objetivo">Objetivo</h2>
<p>Queremos predecir la preferencia de un individuo entre cuatro posibles marcas de galletas saladas en función de las características de venta de cada una de las marcas.</p>
</section>
<section id="enfoque-del-modelo" class="level2">
<h2 class="anchored" data-anchor-id="enfoque-del-modelo">Enfoque del modelo</h2>
<p>La variable respuesta es la variable <em>choice</em>. Una variable nominal con cuatro categorías que identifica la marca preferida de cada individuo.</p>
<p>Tenemos dos variables dicotómicas para cada marca. La variable <em>display</em> indica si la marca tenía un display o no. Y la variable <em>feat</em> indica si había un anuncio en el periódico o no.</p>
<p>También la variable continua <em>price</em> sobre el precio de la marca.</p>
</section>
<section id="train-y-test" class="level2">
<h2 class="anchored" data-anchor-id="train-y-test">Train y test</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>test_0 <span class="ot">&lt;-</span> Cracker_clean <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop =</span> <span class="fl">0.10</span>, <span class="at">by =</span> <span class="fu">c</span>(id))</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>train_0 <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(Cracker_clean <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">r=</span><span class="fu">row_number</span>()), test_0 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">r=</span><span class="fu">row_number</span>()), <span class="at">by=</span><span class="st">'r'</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>r)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="modelo-respuesta-múltiple-nominal" class="level2">
<h2 class="anchored" data-anchor-id="modelo-respuesta-múltiple-nominal">Modelo respuesta múltiple nominal</h2>
<p>Usamos la librería VGAM para un modelo repuesta múltiple nominal y donde debemos elegir una categoría de referencia. El resultado del modelo indicará cómo de probable es la elección de cada una de las tres marcas en relación a la categoría de referencia para cada individuo en función.</p>
<p><u><strong>Modelo 1</strong></u></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>modelo1 <span class="ot">&lt;-</span> <span class="fu">vglm</span>((choice) <span class="sc">~</span> disp.sunshine <span class="sc">+</span> disp.kleebler <span class="sc">+</span> disp.nabisco <span class="sc">+</span> disp.private <span class="sc">+</span> feat.sunshine <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>feat.kleebler <span class="sc">+</span> feat.nabisco <span class="sc">+</span> feat.private <span class="sc">+</span> price.sunshine <span class="sc">+</span> price.kleebler <span class="sc">+</span> price.nabisco <span class="sc">+</span> price.private,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="at">family=</span><span class="fu">multinomial</span>(<span class="at">refLevel=</span><span class="st">'private'</span>),</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_0)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
vglm(formula = (choice) ~ disp.sunshine + disp.kleebler + disp.nabisco + 
    disp.private + feat.sunshine + feat.kleebler + feat.nabisco + 
    feat.private + price.sunshine + price.kleebler + price.nabisco + 
    price.private, family = multinomial(refLevel = "private"), 
    data = train_0)

Coefficients: 
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept):1     1.033643   1.079841   0.957  0.33846    
(Intercept):2     3.240528   1.026201   3.158  0.00159 ** 
(Intercept):3     2.985972   0.588396   5.075 3.88e-07 ***
disp.sunshine:1   0.054419   0.227660   0.239  0.81108    
disp.sunshine:2   0.148286   0.267927   0.553  0.57995    
disp.sunshine:3  -0.047829   0.149977  -0.319  0.74979    
disp.kleebler:1  -0.041638   0.300758  -0.138  0.88989    
disp.kleebler:2   0.363891   0.247817   1.468  0.14200    
disp.kleebler:3   0.388701   0.149763   2.595  0.00945 ** 
disp.nabisco:1    0.694167   0.171677   4.043 5.27e-05 ***
disp.nabisco:2   -0.207659   0.186150  -1.116  0.26462    
disp.nabisco:3    0.122689   0.092027   1.333  0.18247    
disp.private:1   -0.037323   0.311962  -0.120  0.90477    
disp.private:2    0.490122   0.297660   1.647  0.09964 .  
disp.private:3    0.290532   0.161024   1.804  0.07119 .  
feat.sunshine:1   0.379091   0.318599   1.190  0.23410    
feat.sunshine:2  -0.742923   0.641065  -1.159  0.24650    
feat.sunshine:3  -0.012272   0.260187  -0.047  0.96238    
feat.kleebler:1   0.753286   0.418592   1.800  0.07193 .  
feat.kleebler:2   0.884267   0.346049   2.555  0.01061 *  
feat.kleebler:3   0.778623   0.251425   3.097  0.00196 ** 
feat.nabisco:1    0.916603   0.295163   3.105  0.00190 ** 
feat.nabisco:2    0.407333   0.388872   1.047  0.29488    
feat.nabisco:3    0.786316   0.180687   4.352 1.35e-05 ***
feat.private:1   -0.020461   0.406588  -0.050  0.95986    
feat.private:2   -1.280419   0.548577  -2.334  0.01959 *  
feat.private:3   -0.664342   0.227238  -2.924  0.00346 ** 
price.sunshine:1 -0.061008   0.007114  -8.576  &lt; 2e-16 ***
price.sunshine:2  0.002758   0.007336   0.376  0.70700    
price.sunshine:3 -0.006179   0.004122  -1.499  0.13389    
price.kleebler:1  0.008903   0.008604   1.035  0.30082    
price.kleebler:2 -0.051508   0.008572  -6.009 1.87e-09 ***
price.kleebler:3  0.007318   0.004458   1.641  0.10070    
price.nabisco:1   0.014084   0.007065   1.994  0.04620 *  
price.nabisco:2  -0.001807   0.006564  -0.275  0.78309    
price.nabisco:3  -0.031587   0.003413  -9.256  &lt; 2e-16 ***
price.private:1   0.002303   0.007229   0.319  0.75005    
price.private:2   0.011414   0.006489   1.759  0.07858 .  
price.private:3   0.008875   0.003640   2.438  0.01477 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Names of linear predictors: log(mu[,1]/mu[,4]), log(mu[,2]/mu[,4]), log(mu[,3]/mu[,4])

Residual deviance: 6013.561 on 9027 degrees of freedom

Log-likelihood: -3006.78 on 9027 degrees of freedom

Number of Fisher scoring iterations: 6 

Warning: Hauck-Donner effect detected in the following estimate(s):
'price.sunshine:1', 'price.kleebler:2'


Reference group is level  4  of the response</code></pre>
</div>
</div>
<p><u><strong>Modelo 2</strong></u></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sin disp.sunshine, feat.sunshine</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>modelo2 <span class="ot">&lt;-</span> <span class="fu">vglm</span>((choice) <span class="sc">~</span> disp.kleebler <span class="sc">+</span> disp.nabisco <span class="sc">+</span> disp.private <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>                  feat.kleebler <span class="sc">+</span> feat.nabisco <span class="sc">+</span> feat.private <span class="sc">+</span> price.sunshine <span class="sc">+</span> price.kleebler <span class="sc">+</span> price.nabisco <span class="sc">+</span> price.private,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">family=</span><span class="fu">multinomial</span>(<span class="at">refLevel=</span><span class="st">'private'</span>),</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> train_0)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(modelo2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
vglm(formula = (choice) ~ disp.kleebler + disp.nabisco + disp.private + 
    feat.kleebler + feat.nabisco + feat.private + price.sunshine + 
    price.kleebler + price.nabisco + price.private, family = multinomial(refLevel = "private"), 
    data = train_0)

Coefficients: 
                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept):1     1.329052   1.044039   1.273  0.20302    
(Intercept):2     3.235384   0.996215   3.248  0.00116 ** 
(Intercept):3     2.934195   0.566395   5.180 2.21e-07 ***
disp.kleebler:1  -0.050532   0.302626  -0.167  0.86739    
disp.kleebler:2   0.386044   0.245896   1.570  0.11643    
disp.kleebler:3   0.388526   0.149647   2.596  0.00942 ** 
disp.nabisco:1    0.713119   0.171099   4.168 3.07e-05 ***
disp.nabisco:2   -0.209734   0.185761  -1.129  0.25887    
disp.nabisco:3    0.121202   0.091893   1.319  0.18719    
disp.private:1   -0.058101   0.311081  -0.187  0.85184    
disp.private:2    0.497754   0.298145   1.670  0.09502 .  
disp.private:3    0.290067   0.160950   1.802  0.07151 .  
feat.kleebler:1   0.797313   0.419549   1.900  0.05738 .  
feat.kleebler:2   0.847357   0.343483   2.467  0.01363 *  
feat.kleebler:3   0.779071   0.250979   3.104  0.00191 ** 
feat.nabisco:1    0.909511   0.295305   3.080  0.00207 ** 
feat.nabisco:2    0.396573   0.388736   1.020  0.30765    
feat.nabisco:3    0.786379   0.180682   4.352 1.35e-05 ***
feat.private:1   -0.046561   0.405830  -0.115  0.90866    
feat.private:2   -1.276918   0.549256  -2.325  0.02008 *  
feat.private:3   -0.664670   0.227223  -2.925  0.00344 ** 
price.sunshine:1 -0.065561   0.005870 -11.170  &lt; 2e-16 ***
price.sunshine:2  0.003458   0.006530   0.530  0.59635    
price.sunshine:3 -0.005558   0.003579  -1.553  0.12039    
price.kleebler:1  0.010011   0.008518   1.175  0.23989    
price.kleebler:2 -0.051882   0.008557  -6.063 1.34e-09 ***
price.kleebler:3  0.007294   0.004449   1.640  0.10109    
price.nabisco:1   0.014428   0.007047   2.047  0.04061 *  
price.nabisco:2  -0.002082   0.006552  -0.318  0.75070    
price.nabisco:3  -0.031609   0.003412  -9.265  &lt; 2e-16 ***
price.private:1   0.002177   0.007210   0.302  0.76271    
price.private:2   0.011558   0.006446   1.793  0.07298 .  
price.private:3   0.008753   0.003618   2.419  0.01556 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Names of linear predictors: log(mu[,1]/mu[,4]), log(mu[,2]/mu[,4]), log(mu[,3]/mu[,4])

Residual deviance: 6018.449 on 9033 degrees of freedom

Log-likelihood: -3009.224 on 9033 degrees of freedom

Number of Fisher scoring iterations: 5 

Warning: Hauck-Donner effect detected in the following estimate(s):
'price.sunshine:1', 'price.kleebler:2'


Reference group is level  4  of the response</code></pre>
</div>
</div>
<p><u><strong>Coeficientes modelo final (modelo 2)</strong></u></p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(modelo2, <span class="at">matrix =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               log(mu[,1]/mu[,4]) log(mu[,2]/mu[,4]) log(mu[,3]/mu[,4])
(Intercept)           1.329052476        3.235383770        2.934194986
disp.kleebler        -0.050532377        0.386044328        0.388526021
disp.nabisco          0.713119374       -0.209734090        0.121202003
disp.private         -0.058100609        0.497754290        0.290066638
feat.kleebler         0.797312775        0.847357362        0.779070563
feat.nabisco          0.909511164        0.396572521        0.786378926
feat.private         -0.046561189       -1.276917548       -0.664669803
price.sunshine       -0.065560793        0.003458465       -0.005558358
price.kleebler        0.010011072       -0.051882074        0.007293916
price.nabisco         0.014428284       -0.002081653       -0.031608790
price.private         0.002176899        0.011557912        0.008752862</code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mycol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"darkgreen"</span>,<span class="st">"blue"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotvgam</span>(modelo2, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">scale=</span><span class="dv">12</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lcol=</span>mycol[<span class="dv">1</span>], <span class="at">scol=</span>mycol[<span class="dv">1</span>], <span class="at">which.term=</span><span class="dv">1</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plotvgam</span>(modelo2, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">scale=</span><span class="dv">12</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">lcol=</span>mycol[<span class="dv">2</span>], <span class="at">scol=</span>mycol[<span class="dv">2</span>], <span class="at">which.term=</span><span class="dv">2</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plotvgam</span>(modelo2, <span class="at">se=</span><span class="cn">TRUE</span>, <span class="at">scale=</span><span class="dv">12</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">lcol=</span>mycol[<span class="dv">3</span>], <span class="at">scol=</span>mycol[<span class="dv">3</span>], <span class="at">which.term=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Comparamos el primer modelo con el segundo modelo.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Comparamos el primer modelo con el segundo modelo</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(modelo1) <span class="sc">-</span> <span class="fu">deviance</span>(modelo2)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>(dfdiff <span class="ot">&lt;-</span> <span class="fu">df.residual</span>(modelo2) <span class="sc">-</span> <span class="fu">df.residual</span>(modelo1))</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(<span class="fu">deviance</span>(modelo1) <span class="sc">-</span> <span class="fu">deviance</span>(modelo2), <span class="at">df=</span>dfdiff)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -4.887634
[1] 6
[1] 1</code></pre>
</div>
</div>
<p>Enfocamos el modelo con medidas repetidas, ya que para cada individuo contamos con más de una observación.</p>
<p>Usamos la librería VGAM para un modelo mixto de repuesta múltiple nominal y donde debemos elegir una categoría de referencia. El resultado del modelo indicará cómo de probable es la elección de cada una de las tres marcas en relación a la categoría de referencia para cada individuo en función.</p>
<p>El modelo saturado inicial cuenta con una parte aleatoria. * Pendiente aleatoria. Nos dará información sobre si cada</p>
<p>modelo443 &lt;- vglm(puntuacion ~ tratamiento*semana, family=cumulative(link = logitlink), data = mitema4) summary(modelo443)</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>